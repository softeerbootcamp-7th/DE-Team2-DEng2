# Data Pipeline
본 Data Pipeline은 **외부 원천 데이터 수집** &rarr; **정제·통합** &rarr; **DB 적재**까지의 전 과정을 일관된 흐름으로 관리하기 위한 파이프라인입니다.

토지·건축물대장·식당·화물차주 관련 다양한 공공 및 민간 데이터를 대상으로 하며, 데이터의 신뢰성, 재현성, 확장성을 핵심 목표로 설계되었습니다.

파이프라인은 크게 **Extract** / **Transform** / **Load** 세 단계로 구성됩니다.

Extract 단계에서는 정부24, VWorld (국토교통부), PDF 문서, 웹 페이지 등 서로 다른 형식의 원천 데이터에 접근하여 원본 데이터를 최대한 손실 없이 수집하고, 가공되지 않은 Raw 데이터로 저장합니다.

Transform 단계에서는 대용량 데이터 처리를 위해 Apache Spark 기반으로 변환 로직을 구현하였으며, 연산 비용과 재처리 범위를 최소화하도록 단계별로 최적화하였습니다. 또한 토지·건축·식당·차주 등 데이터 소스별 수집 주기와 변경 빈도가 서로 다르다는 점을 고려하여, Bronze → S_clean → S0 → S1 → S2 → Gold와 같은 다층 구조로 변환 단계를 분리하고, 필요한 단계만 선택적으로 재처리할 수 있도록 설계하였습니다.

Load 단계에서는 변환이 완료된 데이터를 AWS RDS에 적재하여, 이후 분석·대시보드·업무 활용을 위한 신뢰 가능한 데이터 저장소를 구성합니다.

## Extract
#### 📌 개요
Extract 단계에서는 토지·건축물대장·식당·화물차주 등 각 데이터 소스의 특성과 제공 방식에 맞추어 개별적인 수집 로직을 구현하였습니다.


#### 1. 화물차주분포: [국토교통 통계누리](https://stat.molit.go.kr/portal/cate/statView.do?hRsId=58&hFormId=5498&hSelectId=5559&hPoint=00&hAppr=1&hDivEng=&oFileName=&rFileName=&midpath=&sFormId=5498&sStyleNum=1&settingRadio=xlsx) (Monthly)
화물차주분포 데이터는 **전국 단위에서 화물차주가 어디에 집중되어 거주하고 있는지를 파악하기 위한 기준 데이터**로 활용됩니다.

**사용 용도**
1. **어느 시도가 다른 시도에 비해 화물차주 비중이 높은지**를 파악합니다.
2. 동일 시도 내에서 시군구 단위의 분포를 비교하여 **해당 시도 안에서도 어떤 시군구에 화물차주가 상대적으로 많이 분포하는지**를 분석합니다.


#### 2. 건축물대장: [건축HUB](https://www.hub.go.kr/portal/opn/lps/idx-lgcpt-pvsn-srvc-list.do) (Monthly)
건축물대장 데이터는 전국 모든 건물에 대한 데이터로서, **토지에 건축물이 존재하는지, 한 건축물 내에 몇개의 음식점이 존재하는지**를 파악하기 위한 데이터입니다.

**사용 용도**
1. 건축물대장과 토지소유정보를 비교하여 건물이 존재하는 토지와 없는 토지를 구분합니다. 이를 통해 토지 전체 면적 중 건축물에 의해 점유되지 않은 면적을 계산하고, 실제 주차장으로 활용 가능한 유휴 면적 추정의 기준 데이터로 사용합니다.
2. 동일 필지 또는 동일 건물에 속한 건축물 식별 정보를 활용하여, **하나의 건물에 여러 음식점이 입접해 있는지 여부**를 판단합니다. 단일 건물 내 음식점 수가 많을수록, 주차 공간을 야간 주차장으로 활용하기 위해 **영업·협의해야 할 주체**의 수가 증가하게 됩니다.  
이는 계약 과정의 복잡도 증가, 이해관계 조정 비용 상승, 운영 중 분쟁 가능성 확대 등으로 이어질 수 있으므로, 야간 주차장 운영 관점에서는 부정적인 요인으로 작용합니다. 이에 따라 해당 정보는 다수 음식점 입점 건물에 대해 감점 요인으로 반영되는 지표로 사용됩니다.


#### 3. 토지소유정보: [VWorld](https://www.vworld.kr/dtmk/dtmk_ntads_s002.do?searchKeyword=%ED%86%A0%EC%A7%80%EC%86%8C%EC%9C%A0%EC%A0%95%EB%B3%B4&searchSvcCde=&searchOrganization=&searchBrmCode=&searchTagList=&searchFrm=&pageIndex=1&gidmCd=&gidsCd=&sortType=00&svcCde=NA&dsId=12&listPageIndex=1) (Monthly)
토지소유정보 데이터는 **전국 모든 필지를 지번 단위로 포괄하는 데이터**로서, 주차장 후보지의 **물리적 적합성**과 **계약 가능성**을 판단하기 위한 핵심 기준 데이터로 활용됩니다.

**사용 용도**
1. 토지의 **지목(地目)** 정보를 활용하여 해당 필지가 **법적으로 주차장으로 활용 가능한 성격의 토지인지 여부**를 판단합니다.
2. 토지의 **면적 정보**를 활용하여, 한 음식점의 소유라고 생각되는 여러 토지의 면적을 합한 값이 **얼마나 많은 대형 화물차를 수용할 수 있는지**를 판단합니다.
3. 토지의 **소유권 변동일자** 정보를 활용하여 인접한 여러 필지의 소유권이 **동일한 날짜에 변동된 경우**, 해당 필지들이 **동일 지주에 의해 소유되고 있을 가능성**을 추정합니다.


#### 4. 토지대장: [정부24](https://www.gov.kr/mw/AA020InfoCappView.do?CappBizCD=13100000026) (Monthly)
토지대장 데이터는 **개별 필지의 법적 소유 관계를 확인하기 위한 행정 문서 기반 데이터**입니다. 본 파이프라인에서는 토지소유정보로 1차적인 소유 구조를 추정한 이후, 실제 계약 가능성을 보다 정밀하게 판단하기 위한 데이터로 활용합니다.

**사용 용도**
1. 토지의 실제 **지주(소유자) 정보를 확인**합니다.이를 통해 해당 토지 위에 위치한 음식점의 대표자와 지주가 동일 인물인지 여부를 판단합니다. 음식점 대표자와 지주가 동일한 경우, 계약 및 협의 과정에서 이해관계 주체가 1명으로 축소됩니다. 이는 의사결정 속도 향상, 협상 단순화, 운영 리스크 감소로 이어질 수 있으므로
영업 가능성이 높은 구조로 평가됩니다.

🔥 정부24 토지대장은 수집 과정에 구조적인 제약이 존재합니다. 수집 시작 시마다 복잡한 본인 인증 과정이 필요하며, 일정 시간이 경과하면 명확한 오류 없이 요청이 지연되는 등 대량·장시간 자동 수집이 안정적으로 수행되지 않는 특성이 있습니다.
이에 따라 전국 모든 필지에 대해 토지대장을 일괄 수집하는 것은 현실적으로 불가능하다고 판단하였습니다. 본 파이프라인에서는 **Transform** 단계의 S0 스테이지에서 후보 식당과 연관된 토지를 1차적으로 필터링한 이후, 축소된 대상 필지에 대해서만 선택적으로 토지대장을 수집합니다.


#### 5. 음식점대표자: [식품안전나라](https://www.foodsafetykorea.go.kr/portal/specialinfo/searchInfoCompany.do?menu_grp=MENU_NEW04&menu_no=2813) (Weekly)
음식점 대표자 데이터는 **전국 음식점 리스트와 각 음식점의 대표자 정보**를 확보하기 위한 데이터입니다. 본 파이프라인에서는 후보 식당을 생성하고, 이후 지주와의 관계를 판단하기 위한 핵심 입력 데이터로 활용합니다.

또한 다른 데이터에 비해 **변경 및 갱신 주기가 빠른 데이터**이므로, **주 단위**로 수집하도록 운영합니다.

**사용 용도**
1. 전국 음식점의 기본 식별 정보 (업체명, 주소)와 대표자 정보를 확보하여, 후보 식당 풀을 구성합니다.
2. 토지대장 기반 지주 정보와 결합하여 **대표자 ↔ 지주 동일인 여부**를 판단하고, 계약/협의 난이도를 평가하는 지표로 활용합니다.
3. 대표자 정보의 변경을 주 단위로 반영하여, 후보 식당 및 점수 산정 결과가 최신 상태를 유지하도록 합니다.


#### 6. 도로명주소 및 위치좌표: [주소정보누리집](https://www.juso.go.kr/) (Monthly)
도로명주소 데이터는 **식당, 건물, 토지 등 서로 다른 데이터 소스를 동일한 주소 기준으로 연결하기 위한 데이터**입니다. 본 파이프라인에서는 도로명주소를 중심으로 지번주소를 매핑하고, 해당 위치의 좌표 정보를 생성합니다.

**사용 용도**
1. 식당 데이터의 도로명주소를 기준으로 **지번주소를 매핑**하여 토지 및 건축물 데이터와 조인 가능한 공통 식별 코드를(PNU코드) 생성합니다.
2. 도로명주소에 대응되는 **위도·경도 좌표를 생성**하여, 모든 식당과 필지를 공간 좌표 기반으로 분석할 수 있도록 합니다.
3. 주소 체계가 서로 다른 데이터 소스(도로명주소 기반 식당 데이터, 지번 기반 토지 데이터 등)를 **동일한 주소 단위로 통합**하기 위한 기준 키로 활용됩니다.

## Transform
### 📌 개요

Transform 단계는 원천 데이터를 정제하고 단계적으로 통합하여 **주차 가능 식당을 탐색하고 평가하는 분석 파이프라인**입니다.

이 단계에서는 주소 정보, 공간 정보, 식당 정보, 토지 소유 구조를 결합하여  
**실제로 영업할 식당 주차장 후보를 계산하고 점수화**합니다.

---

### 📌 전체 데이터 처리 흐름

Bronze → Silver (S_clean → S0 → S1 → S2) → Gold

| Layer | 역할 | 배치 주기 |
|---|---|---|
| Bronze | 원천 데이터 적재 | - |
| S_clean | 도메인별 정제 | - |
| S0 | 토지, 건축물, 주소 기반 공간 데이터 통합 | 월 배치 |
| S1 | 식당이 위치한 토지 기반 주차장 후보 생성 | 주 배치 |
| S2 | 토지별 소유권(지주, 식당 대표자) 매칭 | 주 배치 |
| Gold | 주차장 후보별 지표 점수 계산 및 서빙 데이터 생성 | 필요 시 재생성 |

---

### 📌 Transform이 생성하는 데이터

Transform의 최종 목적은 **사업성이 평가된 주차장 후보 리스트 제공**입니다.

최종 서비스 단계의 데이터인 Gold 레이어에는 다음 정보가 포함됩니다.

- 식당 위치
- 실제 사용 가능한 유휴 주차 면적
- 영업 적합성 (운영 난이도)
- 수익성
- 종합 추천 점수
---

### 📌 Transform의 핵심 처리 구조

Transform은 다음 세 단계의 데이터 처리로 구성됩니다.

1. 공간 정보 연결 (Integration)
2. 소유 구조 feature 생성 (Feature Engineering)
3. 사업성 점수 계산 (Scoring)

---

### 1. 공간 정보 구성 (Spatial Data Integration)

목적: 식당이 실제 어떤 위치에 있으며, 해당 위치의 토지·건물 구조가 어떻게 구성되어 있는지 파악

수행 작업:

- 식당 데이터의 도로명주소를 기준으로 주소-좌표 데이터와 조인하여 식당의 위도/경도 계산
- 토지 데이터와 건축물 데이터를 조인하여 각 필지의 건물 구성 정보 생성
- 식당이 속한 토지 필지 식별

즉, 다음 정보를 연결합니다.

식당 → 위치(위도/경도) → 토지 → 건물 구조

결과:

- 모든 식당의 정확한 좌표 확보
- 식당이 위치한 토지 필지 식별
- 해당 필지의 건물 구성 정보 확보
- 이후 유휴부지 면적 계산을 위한 물리적 기준 데이터 생성

---

### 2. 소유 구조 분석 (Ownership Modeling)

목적: 법적으로 계약 및 운영 난이도를 평가하기 위한 feature 생성

수행 작업:

- 토지대장 크롤링 대상 리스트 생성
- 크롤링한 토지대장에서 OCR 기반 지주 추론
- 식당 대표자 ↔ 지주 매칭
- 토지 공유 지분 구조 분석

결과:
- 이후 영업 적합도 평가 단계에서 사용될 feature 생성
    - 동일 인물 여부
    - 공유자 수
    - 소유 형태
---

### 3. 사업성 평가 (Business Scoring)

목적: 생성된 feature를 기반으로 주차 후보의 사업성을 정량적으로 평가

각 식당 후보에 대해 다음 요소를 계산합니다.

---

#### (1) 영업 적합도

운영 및 계약 난이도를 평가합니다.

반영 요소:

- 대표자 = 지주 일치 여부
- 건축물 유형
- 공유 지분 구조
- 대표자 수
- 업종 유형

의미:

“운영하고 계약하기 쉬운 식당인가?”

---

#### (2) 수익성

주차장 규모 기반 기대이익 평가

반영 요소:

- 유휴부지 면적

의미:

“얼마나 경제적 가치가 있는 공간인가?”

#### (3) 종합 점수
최종 추천 ranking에 사용되는 총 점수 계산

반영 요소:
* 영업 적합도
* 수익성

---

### 📌 활용
Transform 최종 결과는 웹 기반 서비스 서비용 데이터셋으로 사용됩니다.
